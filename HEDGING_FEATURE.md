# Функциональность хеджирования процентного риска

## Обзор

В системе CFO/CTO Helper MVP добавлена возможность моделирования эффекта от использования инструментов хеджирования процентного риска. Это позволяет пользователям анализировать, как различные финансовые инструменты могут снизить воздействие изменения процентных ставок на их кредитный портфель.

## Новые компоненты

### HedgingPanel
Компонент для управления инструментами хеджирования:
- Расположен: `frontend/src/components/analysis/HedgingPanel.tsx`
- Функции:
  - Выбор и настройка инструментов хеджирования
  - Расчет комбинированного эффекта хеджирования
  - Отображение параметров инструментов

## Поддерживаемые инструменты хеджирования

### 1. Процентный своп (IRS)
- **Описание**: Обмен плавающей ставки на фиксированную
- **Эффект**: 85% снижения риска
- **Параметры**: Номинальная сумма, фиксированная ставка

### 2. Процентный кэп (CAP)
- **Описание**: Ограничение максимальной процентной ставки
- **Эффект**: 60% снижения риска
- **Параметры**: Номинальная сумма, максимальная ставка

### 3. Процентный флор (FLOOR)
- **Описание**: Установление минимальной процентной ставки
- **Эффект**: 40% снижения риска
- **Параметры**: Номинальная сумма, минимальная ставка

### 4. Процентный коллар (COLLAR)
- **Описание**: Комбинация кэпа и флора
- **Эффект**: 70% снижения риска
- **Параметры**: Номинальная сумма, максимальная и минимальная ставки

### 5. Валютно-процентный своп
- **Описание**: Обмен процентных платежей в разных валютах
- **Эффект**: 75% снижения риска
- **Параметры**: Номинальная сумма, фиксированная ставка

## Расчет эффекта хеджирования

### Формула комбинированного эффекта
При использовании нескольких инструментов применяется формула диверсификации:

```
Общий_эффект = Σ(Эффект_i × (1 - Накопленный_эффект_{i-1}))
```

Максимальный эффект ограничен 95% для реалистичности.

### Применение к сценарному анализу
1. **Расчет базового сценария**: Выполняется стандартный расчет влияния изменения ставок
2. **Применение хеджирования**: 
   ```
   Хеджированная_разница = Базовая_разница × (1 - Эффект_хеджирования)
   Итоговая_сумма = Текущая_сумма + Хеджированная_разница
   ```

## Изменения в интерфейсе

### Новая компоновка страницы анализа
- **Верхняя панель**: Выбор сценария, выбор кредитов, хеджирование (в 3 колонки)
- **Нижняя панель**: Результаты анализа на всю ширину экрана

### Обновленный график
- **Сплошные линии**: Ставки без хеджирования
- **Пунктирные линии**: Ставки с учетом хеджирования
- **Легенда**: Автоматически обновляется с указанием хеджированных инструментов

### Расширенная таблица результатов
- Новая колонка "Эффект хеджирования" (отображается при наличии инструментов)
- Бейджи с процентом снижения риска

### Обновленная сводка
- Количество инструментов хеджирования
- Общий эффект снижения риска
- Список используемых инструментов

## Техническая реализация

### Состояние компонента
```typescript
const [hedgingInstruments, setHedgingInstruments] = useState<HedgingInstrument[]>([]);
```

### Интерфейс инструмента
```typescript
interface HedgingInstrument {
  id: string;
  name: string;
  type: 'IRS' | 'CAP' | 'FLOOR' | 'COLLAR' | 'SWAP';
  description: string;
  parameters: {
    notional?: number;
    strike?: number;
    cap?: number;
    floor?: number;
    fixedRate?: number;
    maturity?: string;
  };
  effect: number; // Процент снижения риска
}
```

### Интеграция с расчетами
Эффект хеджирования применяется на этапе финальных расчетов в функции `runScenarioAnalysis()`:

```typescript
// Применяем эффект хеджирования
if (hedgingInstruments.length > 0) {
  const hedgingEffect = hedgingInstruments.reduce((acc, inst) => {
    return acc + inst.effect * (1 - acc);
  }, 0);
  
  const hedgedDifference = (scenarioInterest - currentInterest) * (1 - hedgingEffect);
  scenarioInterest = currentInterest + hedgedDifference;
}
```

## Использование

1. **Выбор сценария и кредитов**: Стандартный процесс выбора
2. **Добавление инструментов хеджирования**:
   - Нажать "Добавить инструмент" в панели хеджирования
   - Выбрать тип инструмента из выпадающего списка
   - Настроить параметры (номинал автоматически равен общей сумме выбранных кредитов)
   - Подтвердить добавление
3. **Анализ результатов**: Система автоматически пересчитывает результаты с учетом хеджирования

## Будущие улучшения

- Интеграция с внешними API для получения актуальных цен на деривативы
- Расчет стоимости хеджирования
- Поддержка более сложных стратегий хеджирования
- Исторический анализ эффективности хеджирования
- Оптимизация портфеля инструментов хеджирования